<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#000000">
    <title>Decoder Pro | Offline</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="data:application/manifest+json,{'name':'Decoder Pro','short_name':'Decoder','start_url':'.','display':'standalone','background_color':'#000000','theme_color':'#1DB954'}">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { --spotify-green: #1DB954; }
        body { 
            background: #000; 
            color: #fff; 
            font-family: ui-sans-serif, system-ui, sans-serif; 
            height: 100dvh; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            overflow: hidden;
            padding: env(safe-area-inset-top) 0 env(safe-area-inset-bottom) 0;
        }
        .lyrics-container {
            mask-image: linear-gradient(to bottom, transparent, black 25%, black 75%, transparent);
            -webkit-mask-image: linear-gradient(to bottom, transparent, black 25%, black 75%, transparent);
            scrollbar-width: none;
        }
        .lyric-line { transition: all 0.4s; opacity: 0.2; transform: scale(0.9); }
        .lyric-line.active { opacity: 1; transform: scale(1.1); color: var(--spotify-green); }
        input[type="range"] { -webkit-appearance: none; width: 100%; height: 4px; background: #333; border-radius: 2px; }
        input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; width: 16px; height: 16px; background: #fff; border-radius: 50%; }
    </style>
</head>
<body>

    <audio id="audio-engine" playsinline></audio>
    <input type="file" id="file-input" accept="video/*,audio/*" class="hidden">

    <!-- Landing -->
    <div id="screen-upload" class="flex flex-col items-center justify-center p-8 w-full max-w-md">
        <h1 class="text-5xl font-black italic mb-8">DECODER</h1>
        <button id="trigger-upload" class="w-full bg-zinc-900 border border-zinc-800 p-10 rounded-[3rem] flex flex-col items-center gap-4">
            <div class="w-16 h-16 bg-green-500 rounded-2xl flex items-center justify-center">
                <svg width="32" height="32" viewBox="0 0 256 256"><path d="M208,32H48A16,16,0,0,0,32,48V208a16,16,0,0,0,16,16H208a16,16,0,0,0,16-16V48A16,16,0,0,0,208,32Z" opacity="0.2"></path><path d="M208,32H48A16,16,0,0,0,32,48V208a16,16,0,0,0,16,16H208a16,16,0,0,0,16-16V48A16,16,0,0,0,208,32Zm0,176H48V48H208V208Z"></path></svg>
            </div>
            <span class="font-bold uppercase tracking-widest text-sm">Open File</span>
        </button>
        <p id="offline-status" class="mt-4 text-[10px] text-zinc-500 uppercase tracking-widest">Checking Offline Status...</p>
    </div>

    <!-- Player -->
    <div id="screen-player" class="hidden w-full h-full flex flex-col p-6 max-w-md">
        <header class="flex justify-between items-center py-4">
            <button onclick="location.reload()" class="text-zinc-500">✕</button>
            <div class="text-[10px] font-black tracking-widest text-zinc-700 uppercase">Offline Mode Ready</div>
            <div></div>
        </header>
        <div id="lyrics-scroll" class="lyrics-container flex-1 overflow-y-auto flex flex-col items-center space-y-6 py-32 px-4"></div>
        <div class="pb-12 space-y-6">
            <div class="text-center">
                <h2 id="track-name" class="text-2xl font-black italic truncate text-white">Track Name</h2>
                <button id="trigger-lyrics" class="text-zinc-500 text-[10px] font-bold uppercase mt-2">Add Lyrics</button>
            </div>
            <input type="range" id="seeker" value="0" min="0" step="0.1" class="w-full">
            <div class="flex justify-center">
                <button id="btn-play" class="w-20 h-20 bg-white rounded-full flex items-center justify-center text-black">
                    <svg id="play-icon" width="32" height="32" fill="currentColor" viewBox="0 0 256 256"><path d="M240,128a15.74,15.74,0,0,1-7.6,13.51L88.32,229.75a16,16,0,0,1-24.32-13.51V40a16,16,0,0,1,24.32-13.51L232.4,114.49A15.74,15.74,0,0,1,240,128Z"></path></svg>
                </button>
            </div>
        </div>
    </div>

    <div id="modal-lyrics" class="hidden fixed inset-0 bg-black/95 z-[200] flex flex-col p-8 pt-20">
        <textarea id="lyrics-input" class="flex-1 bg-zinc-900 rounded-3xl p-6 text-white text-lg font-bold" placeholder="Paste lyrics..."></textarea>
        <button id="save-lyrics" class="mt-6 bg-green-500 text-black font-black py-4 rounded-full">Apply</button>
    </div>

    <script>
        // --- OFFLINE SERVICE WORKER REGISTRATION ---
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                const swCode = `
                    const CACHE_NAME = 'decoder-offline-v1';
                    const ASSETS = [
                        '${window.location.href}',
                        'https://cdn.tailwindcss.com'
                    ];
                    self.addEventListener('install', e => {
                        e.waitUntil(caches.open(CACHE_NAME).then(c => c.addAll(ASSETS)));
                    });
                    self.addEventListener('fetch', e => {
                        e.respondWith(caches.match(e.request).then(r => r || fetch(e.request)));
                    });
                `;
                const blob = new Blob([swCode], {type: 'text/javascript'});
                navigator.serviceWorker.register(URL.createObjectURL(blob)).then(() => {
                    document.getElementById('offline-status').innerText = "✓ Offline Mode Active";
                });
            });
        }

        // --- APP LOGIC ---
        const audio = document.getElementById('audio-engine');
        const fileInput = document.getElementById('file-input');
        const playBtn = document.getElementById('btn-play');
        const seeker = document.getElementById('seeker');

        document.getElementById('trigger-upload').onclick = () => fileInput.click();
        fileInput.onchange = (e) => {
            if (e.target.files[0]) {
                audio.src = URL.createObjectURL(e.target.files[0]);
                document.getElementById('track-name').innerText = e.target.files[0].name.split('.')[0];
                document.getElementById('screen-upload').classList.add('hidden');
                document.getElementById('screen-player').classList.remove('hidden');
            }
        };

        playBtn.onclick = () => {
            if (audio.paused) { audio.play(); } else { audio.pause(); }
        };

        audio.ontimeupdate = () => {
            seeker.value = audio.currentTime;
            const lines = document.querySelectorAll('.lyric-line');
            const idx = Math.floor((audio.currentTime / audio.duration) * lines.length);
            lines.forEach((l, i) => {
                l.classList.toggle('active', i === idx);
                if (i === idx) l.scrollIntoView({ behavior: 'smooth', block: 'center' });
            });
        };

        audio.onloadedmetadata = () => seeker.max = audio.duration;
        seeker.oninput = () => audio.currentTime = seeker.value;

        document.getElementById('trigger-lyrics').onclick = () => document.getElementById('modal-lyrics').classList.remove('hidden');
        document.getElementById('save-lyrics').onclick = () => {
            const text = document.getElementById('lyrics-input').value.trim();
            const scroll = document.getElementById('lyrics-scroll');
            scroll.innerHTML = '';
            text.split('\n').forEach(line => {
                const p = document.createElement('p');
                p.className = 'lyric-line text-2xl font-black text-center px-4';
                p.innerText = line;
                scroll.appendChild(p);
            });
            document.getElementById('modal-lyrics').classList.add('hidden');
        };
    </script>
</body>
</html>

