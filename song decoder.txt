<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#000000">
    <title>Decoder Pro | Online</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="data:application/manifest+json,{'name':'Decoder Pro','short_name':'Decoder','start_url':'.','display':'standalone','background_color':'#000000','theme_color':'#1DB954'}">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { --spotify-green: #1DB954; }
        body { 
            background: #000; 
            color: #fff; 
            font-family: ui-sans-serif, system-ui, sans-serif; 
            height: 100dvh; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            overflow: hidden;
            padding: env(safe-area-inset-top) 0 env(safe-area-inset-bottom) 0;
        }
        
        .lyrics-container {
            mask-image: linear-gradient(to bottom, transparent, black 25%, black 75%, transparent);
            -webkit-mask-image: linear-gradient(to bottom, transparent, black 25%, black 75%, transparent);
            scrollbar-width: none;
        }
        .lyrics-container::-webkit-scrollbar { display: none; }

        .lyric-line {
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            opacity: 0.2;
            transform: scale(0.9);
        }
        .lyric-line.active {
            opacity: 1;
            transform: scale(1.1);
            color: var(--spotify-green);
        }

        input[type="range"] {
            -webkit-appearance: none; width: 100%; height: 4px;
            background: #333; border-radius: 2px; outline: none;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none; width: 16px; height: 16px;
            background: #fff; border-radius: 50%; cursor: pointer;
        }

        .btn-active:active { transform: scale(0.95); }
    </style>
</head>
<body>

    <audio id="audio-engine" playsinline></audio>
    <input type="file" id="file-input" accept="video/*,audio/*" class="hidden">

    <!-- Landing Page -->
    <div id="screen-upload" class="flex flex-col items-center justify-center p-8 w-full max-w-md">
        <div class="text-center mb-12">
            <h1 class="text-5xl font-black tracking-tighter italic mb-2 text-white">DECODER</h1>
            <p class="text-zinc-600 text-[10px] tracking-[0.4em] font-bold uppercase">Web Edition 1.0</p>
        </div>

        <button id="trigger-upload" class="btn-active w-full bg-zinc-900 border border-zinc-800 p-10 rounded-[3rem] flex flex-col items-center justify-center gap-4 hover:border-spotify/50 transition-all">
            <div class="w-16 h-16 bg-spotify rounded-2xl flex items-center justify-center shadow-[0_0_20px_rgba(29,185,84,0.3)]">
                <svg width="32" height="32" fill="black" viewBox="0 0 256 256"><path d="M208,32H48A16,16,0,0,0,32,48V208a16,16,0,0,0,16,16H208a16,16,0,0,0,16-16V48A16,16,0,0,0,208,32ZM48,48H208V158.1l-42.34-42.34a8,8,0,0,0-11.32,0L112,158.1,91.31,137.42a8,8,0,0,0-11.32,0L48,170.09ZM208,208H48v-9.13l37.66-37.65,20.68,20.68a8,8,0,0,0,11.32,0L154,145.42,208,199.37V208ZM152,88a12,12,0,1,1,12,12A12,12,0,0,1,152,88Z"></path></svg>
            </div>
            <span class="text-white font-black uppercase tracking-widest text-sm">Select from Gallery</span>
        </button>
    </div>

    <!-- Player Page -->
    <div id="screen-player" class="hidden w-full h-full flex flex-col p-6 max-w-md">
        <header class="flex justify-between items-center py-4">
            <button onclick="location.reload()" class="text-zinc-500">âœ•</button>
            <div class="text-[10px] font-black tracking-[0.3em] text-zinc-700 uppercase">Streaming Audio</div>
            <button id="btn-dl" class="text-spotify font-black text-[10px] uppercase border border-spotify/20 px-3 py-1 rounded-full">Save</button>
        </header>

        <div id="lyrics-scroll" class="lyrics-container flex-1 overflow-y-auto flex flex-col items-center space-y-6 py-32 px-4">
            <p class="text-zinc-800 font-bold italic text-center">Tap 'Lyrics' to add text</p>
        </div>

        <div class="pb-12 space-y-6">
            <div class="text-center">
                <h2 id="track-name" class="text-2xl font-black italic tracking-tighter truncate text-white px-6">Media Track</h2>
                <button id="trigger-lyrics" class="text-zinc-500 text-[10px] font-bold uppercase tracking-widest mt-1 hover:text-spotify">Add Lyrics</button>
            </div>

            <div class="px-2">
                <input type="range" id="seeker" value="0" min="0" step="0.1" class="w-full">
                <div class="flex justify-between text-[10px] font-mono text-zinc-600 mt-2">
                    <span id="current-time">0:00</span>
                    <span id="duration-time">0:00</span>
                </div>
            </div>

            <div class="flex justify-center">
                <button id="btn-play" class="btn-active w-20 h-20 bg-white rounded-full flex items-center justify-center text-black shadow-xl">
                    <svg id="play-icon" width="32" height="32" fill="currentColor" viewBox="0 0 256 256"><path d="M240,128a15.74,15.74,0,0,1-7.6,13.51L88.32,229.75a16,16,0,0,1-24.32-13.51V40a16,16,0,0,1,24.32-13.51L232.4,114.49A15.74,15.74,0,0,1,240,128Z"></path></svg>
                </button>
            </div>
        </div>
    </div>

    <!-- Lyrics Modal -->
    <div id="modal-lyrics" class="hidden fixed inset-0 bg-black/95 z-[200] flex flex-col p-8 pt-20">
        <textarea id="lyrics-input" class="flex-1 bg-zinc-900 rounded-3xl p-6 text-white text-lg font-bold outline-none border border-zinc-800" placeholder="Paste lyrics here..."></textarea>
        <button id="save-lyrics" class="mt-6 bg-spotify text-black font-black py-4 rounded-full uppercase tracking-widest">Apply</button>
    </div>

    <script>
        // PWA Mock Service Worker
        if ('serviceWorker' in navigator) {
            const blob = new Blob([`self.addEventListener('fetch', function(e){})`], {type: 'text/javascript'});
            navigator.serviceWorker.register(URL.createObjectURL(blob));
        }

        const audio = document.getElementById('audio-engine');
        const fileInput = document.getElementById('file-input');
        const player = document.getElementById('screen-player');
        const landing = document.getElementById('screen-upload');
        const playBtn = document.getElementById('btn-play');
        const seeker = document.getElementById('seeker');

        let activeFile = null;

        document.getElementById('trigger-upload').onclick = () => fileInput.click();
        
        fileInput.onchange = (e) => {
            if (e.target.files[0]) {
                activeFile = e.target.files[0];
                audio.src = URL.createObjectURL(activeFile);
                document.getElementById('track-name').innerText = activeFile.name.replace(/\.[^/.]+$/, "");
                landing.classList.add('hidden');
                player.classList.remove('hidden');
                audio.load();
            }
        };

        playBtn.onclick = () => {
            if (audio.paused) {
                audio.play();
                document.getElementById('play-icon').innerHTML = '<path d="M216,48V208a16,16,0,0,1-16,16H160a16,16,0,0,1-16-16V48a16,16,0,0,1,16-16h40A16,16,0,0,1,216,48ZM112,32H72A16,16,0,0,0,56,48V208a16,16,0,0,0,16,16h40a16,16,0,0,0,16-16V48A16,16,0,0,0,112,32Z"></path>';
            } else {
                audio.pause();
                document.getElementById('play-icon').innerHTML = '<path d="M240,128a15.74,15.74,0,0,1-7.6,13.51L88.32,229.75a16,16,0,0,1-24.32-13.51V40a16,16,0,0,1,24.32-13.51L232.4,114.49A15.74,15.74,0,0,1,240,128Z"></path>';
            }
        };

        audio.ontimeupdate = () => {
            if (!seeker.dragging) {
                seeker.value = audio.currentTime;
                document.getElementById('current-time').innerText = formatTime(audio.currentTime);
            }
            syncLyrics();
        };

        audio.onloadedmetadata = () => {
            seeker.max = audio.duration;
            document.getElementById('duration-time').innerText = formatTime(audio.duration);
        };

        function formatTime(s) {
            const m = Math.floor(s / 60);
            const sec = Math.floor(s % 60);
            return `${m}:${sec < 10 ? '0' : ''}${sec}`;
        }

        document.getElementById('trigger-lyrics').onclick = () => document.getElementById('modal-lyrics').classList.remove('hidden');
        document.getElementById('save-lyrics').onclick = () => {
            const text = document.getElementById('lyrics-input').value.trim();
            const scroll = document.getElementById('lyrics-scroll');
            scroll.innerHTML = '';
            if (text) {
                text.split('\n').forEach(line => {
                    const p = document.createElement('p');
                    p.className = 'lyric-line text-2xl font-black text-center px-4 leading-tight';
                    p.innerText = line;
                    scroll.appendChild(p);
                });
            }
            document.getElementById('modal-lyrics').classList.add('hidden');
        };

        function syncLyrics() {
            const lines = document.querySelectorAll('.lyric-line');
            if (!lines.length) return;
            const idx = Math.floor((audio.currentTime / audio.duration) * lines.length);
            lines.forEach((l, i) => {
                if (i === idx) {
                    l.classList.add('active');
                    l.scrollIntoView({ behavior: 'smooth', block: 'center' });
                } else {
                    l.classList.remove('active');
                }
            });
        }

        seeker.oninput = () => audio.currentTime = seeker.value;
        seeker.addEventListener('touchstart', () => seeker.dragging = true);
        seeker.addEventListener('touchend', () => seeker.dragging = false);

        document.getElementById('btn-dl').onclick = () => {
            if (!activeFile) return;
            const a = document.createElement('a');
            a.href = URL.createObjectURL(activeFile);
            a.download = `Audio_Export.mp4`;
            a.click();
        };
    </script>
</body>
</html>

